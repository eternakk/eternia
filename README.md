# Eternia Project

## Project Structure

The Eternia project follows a specific directory structure for organizing different types of files:

### Documentation
- `docs/`: Contains all project documentation in markdown format.
  - Architecture: `docs/architecture.md`
  - Developer Onboarding: `docs/developer_onboarding.md`
  - Running the Server: `docs/running_the_server.md`
  - UI Architecture: `docs/ui_architecture.md`
  - UI Components: `docs/ui_components.md`
  - UI Development Guidelines: `docs/ui_development_guidelines.md`
  - UI Pending Tasks: `docs/ui_pending_tasks.md`
  - Tasks: `docs/tasks.md`

### Data Storage
- `artifacts/`: Stores artifact files such as:
  - Authentication tokens
  - JWT secrets
  - User data
  - Governor state
  - Checkpoints
  - Profiling data

- `config/`: Contains configuration files and settings.

- `data/`: Stores database files and other persistent data.
  - The main database file is `data/eternia.db`

- `logs/`: Contains all log files generated by the application.
  - Main log file: `logs/eternia.log`
  - Cycle logs: `logs/eterna_cycles.log`
  - Governor events: `logs/governor_events.log`
  - Debug logs: `logs/debug.log`

- `migrations/`: Contains database migration files.
  - Migration files define schema changes and data migrations
  - Managed by the yoyo-migrations system

### Code
- `modules/`: Core modules of the application.
- `services/`: Service components.
- `scripts/`: Utility scripts.
- `tests/`: Test files.
- `ui/`: User interface components.

## Important Note on Data Storage

**Do not store data files in the `docs/` directory.** The `docs/` directory is reserved exclusively for documentation files.

All data files should be stored in their appropriate directories:
- Use `artifacts/` for artifact files
- Use `config/` for configuration files
- Use `data/` for database and other data files
- Use `logs/` for log files

The `.gitignore` file is configured to ignore these data directories to prevent large or sensitive files from being committed to the repository.

## Cleanup Script

A cleanup script (`cleanup_docs.sh`) is provided to remove any data directories that might have been mistakenly created in the `docs/` directory. Run it with:

```bash
./cleanup_docs.sh
```

# Eternia Project

## Project Structure

The Eternia project follows a specific directory structure for organizing different types of files:

### Documentation
- `docs/`: Contains all project documentation in markdown format.
  - Architecture: `docs/architecture.md`
  - Developer Onboarding: `docs/developer_onboarding.md`
  - Running the Server: `docs/running_the_server.md`
  - UI Architecture: `docs/ui_architecture.md`
  - UI Components: `docs/ui_components.md`
  - UI Development Guidelines: `docs/ui_development_guidelines.md`
  - UI Pending Tasks: `docs/ui_pending_tasks.md`
  - Tasks: `docs/tasks.md`

### Data Storage
- `artifacts/`: Stores artifact files such as:
  - Authentication tokens
  - JWT secrets
  - User data
  - Governor state
  - Checkpoints
  - Profiling data

- `config/`: Contains configuration files and settings.

- `data/`: Stores database files and other persistent data.
  - The main database file is `data/eternia.db`

- `logs/`: Contains all log files generated by the application.
  - Main log file: `logs/eternia.log`
  - Cycle logs: `logs/eterna_cycles.log`
  - Governor events: `logs/governor_events.log`
  - Debug logs: `logs/debug.log`

- `migrations/`: Contains database migration files.
  - Migration files define schema changes and data migrations
  - Managed by the yoyo-migrations system

### Code
- `modules/`: Core modules of the application.
- `services/`: Service components.
- `scripts/`: Utility scripts.
- `tests/`: Test files.
- `ui/`: User interface components.

## Important Note on Data Storage

**Do not store data files in the `docs/` directory.** The `docs/` directory is reserved exclusively for documentation files.

All data files should be stored in their appropriate directories:
- Use `artifacts/` for artifact files
- Use `config/` for configuration files
- Use `data/` for database and other data files
- Use `logs/` for log files

The `.gitignore` file is configured to ignore these data directories to prevent large or sensitive files from being committed to the repository.

## Cleanup Script

A cleanup script (`cleanup_docs.sh`) is provided to remove any data directories that might have been mistakenly created in the `docs/` directory. Run it with:

```bash
./cleanup_docs.sh
```

## Secrets & Environments

JWT signing secrets are handled differently in development and production for both convenience and security.

- Environment selection:
  - Set ETERNIA_ENV=development (default) or ETERNIA_ENV=production. APP_ENV is also supported and takes the same values. Values like prod/production are treated as production.

- Development (default):
  - Priority order:
    1) JWT_SECRET or JWT_SECRET_KEY environment variable, if provided.
    2) If SECRET_KEY_ENCRYPTION_PASSWORD is set, an encrypted secret file at artifacts/jwt_secret.txt is used/created.
    3) Otherwise, a local plaintext secret file is created and used at artifacts/dev.jwt_secret.txt (this path is gitignored by default via artifacts/).
  - This ensures your dev server works out-of-the-box and persists the JWT secret locally between restarts.

- Production:
  - Priority order:
    1) JWT_SECRET or JWT_SECRET_KEY environment variable.
    2) Otherwise, you must set SECRET_KEY_ENCRYPTION_PASSWORD. The app will load (or create) an encrypted secret at artifacts/jwt_secret.txt using a salt from artifacts/jwt_secret_salt.bin.
  - There is no ephemeral fallback in production. If neither an env secret nor an encryption password is provided, startup will fail with a clear error.

- Notes:
  - The artifacts/ directory is gitignored to prevent secrets from being committed.
  - To rotate secrets, delete the relevant secret file in artifacts/ and restart with the desired environment variables; a new secret will be generated and saved according to the mode.
  - docker-compose uses ETERNIA_ENV; ensure you set it to production for production deployments and provide either JWT_SECRET or SECRET_KEY_ENCRYPTION_PASSWORD accordingly.
